<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terraform Azure Infrastructure Showcase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .diagram-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin: auto;
            background-color: #f0f4f8;
            border-radius: 0.5rem;
            padding: 2rem;
            border: 1px solid #e2e8f0;
        }
        .resource {
            position: absolute;
            background-color: white;
            border: 2px solid;
            border-radius: 0.5rem;
            padding: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
            cursor: pointer;
        }
        .resource:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .resource .title {
            font-weight: 600;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
        }
         .resource .title svg {
            margin-right: 0.5rem;
        }
        .resource .details {
            font-size: 0.75rem;
            color: #4a5568;
            margin-top: 0.25rem;
        }
        #rg { border-color: #1d4ed8; top: 1rem; left: 1rem; right: 1rem; bottom: 1rem; background-color: rgba(219, 234, 254, 0.3); }
        #vnet { border-color: #059669; top: 6rem; left: 3rem; right: 3rem; bottom: 14rem; background-color: rgba(209, 250, 229, 0.4); }
        #subnet { border-color: #d97706; top: 11rem; left: 5rem; right: 5rem; bottom: 16rem; background-color: rgba(254, 243, 224, 0.5); }
        #nsg { border-color: #be123c; top: 30rem; left: 5rem; width: 12rem;}
        #vm { border-color: #6d28d9; top: 17rem; left: 8rem; width: 12rem; }
        #nic { border-color: #db2777; top: 17rem; left: 22rem; width: 12rem;}
        #pip { border-color: #0891b2; top: 17rem; left: 36rem; width: 12rem;}

        .line {
            position: absolute;
            background-color: #9ca3af;
            z-index: -1;
        }

        .code-container {
            background-color: #1e293b;
            color: #e2e8f0;
            border-radius: 0.5rem;
            padding: 1.5rem;
            overflow-x: auto;
            position: relative;
        }

        .copy-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: #334155;
            color: #e2e8f0;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .copy-button:hover {
            background-color: #475569;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">Terraform Azure Infrastructure</h1>
            <p class="text-lg text-gray-600 mt-2">A dynamic visualization of cloud resources deployed with Terraform.</p>
        </header>

        <main>
            <section class="mb-12">
                <h2 class="text-2xl font-bold mb-4 text-center">Infrastructure Diagram</h2>
                <div class="diagram-container h-[45rem]">
                    <!-- Resources -->
                    <div id="rg" class="resource" data-info="azurerm_resource_group.mtc-rg: A container that holds related resources for an Azure solution.">
                        <div class="title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                            Resource Group
                        </div>
                        <div class="details">mtc-resources</div>
                    </div>
                    <div id="vnet" class="resource" data-info="azurerm_virtual_network.mtc-vn: Provides an isolated environment for your Azure resources.">
                        <div class="title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 18H3c-1.1 0-2-.9-2-2V8c0-1.1.9-2 2-2h20c1.1 0 2 .9 2 2v8c0 1.1-.9 2-2 2h-2"></path><path d="M19 12v-2a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"></path></svg>
                            Virtual Network
                        </div>
                         <div class="details">mtc-network (10.123.0.0/16)</div>
                    </div>
                    <div id="subnet" class="resource" data-info="azurerm_subnet.mtc-subnet: A sub-range of IP addresses in the VNet.">
                        <div class="title">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 10v4"></path><path d="M12 18v-2"></path><path d="M12 8V6"></path><path d="M10 12h4"></path><path d="M18 12h2"></path><path d="M4 12h2"></path></svg>
                            Subnet
                        </div>
                        <div class="details">mtc-subnet (10.123.1.0/24)</div>
                    </div>
                    <div id="vm" class="resource" data-info="azurerm_linux_virtual_machine.mtc-vm: A Linux virtual machine to run applications.">
                         <div class="title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="14" width="18" height="6" rx="2"></rect><path d="M8 14v-4a4 4 0 0 1 4-4h0a4 4 0 0 1 4 4v4"></path><line x1="8" y1="4" x2="16" y2="4"></line><line x1="12" y1="2" x2="12" y2="4"></line></svg>
                            Virtual Machine
                        </div>
                         <div class="details">mtc-vm</div>
                    </div>
                    <div id="nic" class="resource" data-info="azurerm_network_interface.mtc-nic: Enables an Azure VM to communicate with internet, Azure, and on-premises resources.">
                         <div class="title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22a10 10 0 0 0 10-10H2a10 10 0 0 0 10 10Z"></path><path d="M12 12v-2"></path><path d="M12 8V6"></path><path d="M12 4V2"></path></svg>
                           Network Interface
                        </div>
                         <div class="details">mtc-nic</div>
                    </div>
                     <div id="pip" class="resource" data-info="azurerm_public_ip.mtc-ip: A public IP address to communicate with the VM from the internet.">
                        <div class="title">
                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>
                            Public IP
                        </div>
                        <div class="details">mtc-ip</div>
                    </div>
                    <div id="nsg" class="resource" data-info="azurerm_network_security_group.mtc-sg: Filters network traffic to and from Azure resources in an Azure virtual network.">
                         <div class="title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><shield>
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></shield></svg>
                            Network Security Group
                        </div>
                         <div class="details">mtc-sg</div>
                    </div>
                </div>

                <!-- Info Box -->
                 <div id="info-box" class="mt-4 text-center bg-white p-4 rounded-lg shadow-md max-w-xl mx-auto h-16 flex items-center justify-center">
                    <p class="text-gray-600">Hover over a resource to see its description.</p>
                </div>
            </section>

             <section>
                <h2 class="text-2xl font-bold mb-4 text-center">Terraform Code (`main.tf`)</h2>
                <div class="code-container">
                    <button id="copy-button" class="copy-button">Copy</button>
                    <pre><code id="terraform-code" class="language-hcl">
terraform {
  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "=3.0.0"
    }
  }
}

provider "azurerm" {
  features {}
}

resource "azurerm_resource_group" "mtc-rg" {
  name     = "mtc-resources"
  location = "East Us"
  tags = {
    environment = "dev"
  }
}

resource "azurerm_virtual_network" "mtc-vn" {
  name                = "mtc-network"
  resource_group_name = azurerm_resource_group.mtc-rg.name
  location            = azurerm_resource_group.mtc-rg.location
  address_space       = ["10.123.0.0/16"]
  tags = {
    environment = "dev"
  }
}

resource "azurerm_subnet" "mtc-subnet" {
  name                 = "mtc-subnet"
  resource_group_name  = azurerm_resource_group.mtc-rg.name
  virtual_network_name = azurerm_virtual_network.mtc-vn.name
  address_prefixes     = ["10.123.1.0/24"]
}

resource "azurerm_network_security_group" "mtc-sg" {
  name                = "mtc-sg"
  location            = azurerm_resource_group.mtc-rg.location
  resource_group_name = azurerm_resource_group.mtc-rg.name
  tags = {
    environment = "dev"
  }
}

resource "azurerm_network_security_rule" "mtc-dev-rule" {
  name                        = "mtc-dev-rule"
  priority                    = 100
  direction                   = "Inbound"
  access                      = "Allow"
  protocol                    = "*"
  source_port_range           = "*"
  destination_port_range      = "*"
  source_address_prefix       = "*"
  destination_address_prefix  = "*"
  resource_group_name         = azurerm_resource_group.mtc-rg.name
  network_security_group_name = azurerm_network_security_group.mtc-sg.name
}

resource "azurerm_subnet_network_security_group_association" "mtc-sga" {
  subnet_id                 = azurerm_subnet.mtc-subnet.id
  network_security_group_id = azurerm_network_security_group.mtc-sg.id
}

resource "azurerm_public_ip" "mtc-ip" {
  name                = "mtc-ip"
  resource_group_name = azurerm_resource_group.mtc-rg.name
  location            = azurerm_resource_group.mtc-rg.location
  allocation_method   = "Static"
  sku                 = "Standard"
  tags = {
    environment = "dev"
  }
}

resource "azurerm_network_interface" "mtc-nic" {
  name                = "mtc-nic"
  location            = azurerm_resource_group.mtc-rg.location
  resource_group_name = azurerm_resource_group.mtc-rg.name

  ip_configuration {
    name                          = "Internal"
    subnet_id                     = azurerm_subnet.mtc-subnet.id
    private_ip_address_allocation = "Dynamic"
    public_ip_address_id          = azurerm_public_ip.mtc-ip.id
  }
  tags = {
    environment = "dev"
  }
}

resource "azurerm_linux_virtual_machine" "mtc-vm" {
  name                  = "mtc-vm"
  resource_group_name   = azurerm_resource_group.mtc-rg.name
  location              = azurerm_resource_group.mtc-rg.location
  size                  = "Standard_B1s"
  admin_username        = "adminuser"
  network_interface_ids = [azurerm_network_interface.mtc-nic.id]

  custom_data = filebase64("customdata.tpl")

  admin_ssh_key {
    username   = "adminuser"
    public_key = file("~/.ssh/mtcazurekey.pub")
  }

  os_disk {
    caching              = "ReadWrite"
    storage_account_type = "Standard_LRS"
  }

  source_image_reference {
    publisher = "Canonical"
    offer     = "0001-com-ubuntu-server-focal"
    sku       = "20_04-lts-gen2"
    version   = "20.04.202505200"
  }

  provisioner "local-exec" {
    command = templatefile("${var.host_os}-ssh-script.tpl", {
      hostname     = self.public_ip_address,
      user         = "adminuser",
      IdentityFile = "~/.ssh/mtcazurekey"
    })
    interpreter = var.host_os == "windows" ? ["Powershell", "-Command"] : ["bash", "-c"]
  }
  tags = {
    environment = "dev"
  }
}

output "public_ip_address" {
  value = azurerm_linux_virtual_machine.mtc-vm.public_ip_address
}
                    </code></pre>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resources = document.querySelectorAll('.resource');
            const infoBox = document.getElementById('info-box');
            const defaultInfoText = '<p class="text-gray-600">Hover over a resource to see its description.</p>';

            resources.forEach(resource => {
                resource.addEventListener('mouseenter', () => {
                    const info = resource.getAttribute('data-info');
                    infoBox.innerHTML = `<p class="text-gray-800 font-medium">${info}</p>`;
                });
                resource.addEventListener('mouseleave', () => {
                    infoBox.innerHTML = defaultInfoText;
                });
            });

            const copyButton = document.getElementById('copy-button');
            const codeToCopy = document.getElementById('terraform-code').innerText;

            copyButton.addEventListener('click', () => {
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = codeToCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                document.execCommand('copy');
                document.body.removeChild(tempTextArea);
                copyButton.innerText = 'Copied!';
                setTimeout(() => {
                    copyButton.innerText = 'Copy';
                }, 2000);
            });
        });
    </script>

</body>
</html>

